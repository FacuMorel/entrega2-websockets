<div>
    <h2>Productos en Tiempo Real</h2>
    
    <!-- Formulario para crear producto -->
    <div class="form-container">
        <h3>Agregar Nuevo Producto</h3>
        <div id="error-message" style="display: none;" class="error-message"></div>
        <form id="product-form">
            <div class="form-group">
                <label for="title">Título:</label>
                <input type="text" id="title" name="title" required>
            </div>
            <div class="form-group">
                <label for="description">Descripción:</label>
                <input type="text" id="description" name="description" required>
            </div>
            <div class="form-group">
                <label for="code">Código:</label>
                <input type="text" id="code" name="code" required>
            </div>
            <div class="form-group">
                <label for="price">Precio:</label>
                <input type="number" id="price" name="price" step="0.01" required>
            </div>
            <div class="form-group">
                <label for="stock">Stock:</label>
                <input type="number" id="stock" name="stock" required>
            </div>
            <div class="form-group">
                <label for="category">Categoría:</label>
                <input type="text" id="category" name="category" required>
            </div>
            <div class="form-group">
                <label for="status">Estado:</label>
                <select id="status" name="status">
                    <option value="true">Activo</option>
                    <option value="false">Inactivo</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Agregar Producto</button>
        </form>
    </div>

    <!-- Lista de productos -->
    <div id="products-container">
        <h3>Lista de Productos</h3>
        <div id="products-grid" class="products-grid">
            {{#if products.length}}
                {{#each products}}
                    <div class="product-card" data-product-id="{{this.id}}">
                        <h3>{{this.title}}</h3>
                        <p><strong>Descripción:</strong> {{this.description}}</p>
                        <p><strong>Código:</strong> {{this.code}}</p>
                        <p class="price">${{this.price}}</p>
                        <p><strong>Stock:</strong> {{this.stock}}</p>
                        <p><strong>Categoría:</strong> {{this.category}}</p>
                        <p><strong>Estado:</strong> {{#if this.status}}Activo{{else}}Inactivo{{/if}}</p>
                        <button class="btn btn-danger delete-btn" onclick="deleteProduct({{this.id}})">Eliminar</button>
                    </div>
                {{/each}}
            {{else}}
                <div class="empty-state">
                    <p>No hay productos disponibles</p>
                </div>
            {{/if}}
        </div>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();

    // Manejar lista de productos actualizada
    socket.on('products', (products) => {
        updateProductsList(products);
    });

    // Manejar producto creado
    socket.on('productCreated', (product) => {
        console.log('Producto creado:', product);
        hideError();
    });

    // Manejar producto eliminado
    socket.on('productDeleted', (productId) => {
        console.log('Producto eliminado:', productId);
        hideError();
    });

    // Manejar errores
    socket.on('error', (error) => {
        showError(error.message);
    });

    // Formulario de creación
    document.getElementById('product-form').addEventListener('submit', (e) => {
        e.preventDefault();
        
        const formData = new FormData(e.target);
        const productData = {
            title: formData.get('title'),
            description: formData.get('description'),
            code: formData.get('code'),
            price: formData.get('price'),
            stock: formData.get('stock'),
            category: formData.get('category'),
            status: formData.get('status')
        };

        socket.emit('createProduct', productData);
        e.target.reset();
    });

    // Función para eliminar producto
    function deleteProduct(productId) {
        if (confirm('¿Estás seguro de que deseas eliminar este producto?')) {
            socket.emit('deleteProduct', productId);
        }
    }

    // Función para actualizar la lista de productos
    function updateProductsList(products) {
        const productsGrid = document.getElementById('products-grid');
        
        if (products.length === 0) {
            productsGrid.innerHTML = '<div class="empty-state"><p>No hay productos disponibles</p></div>';
            return;
        }

        productsGrid.innerHTML = products.map(product => `
            <div class="product-card" data-product-id="${product.id}">
                <h3>${product.title}</h3>
                <p><strong>Descripción:</strong> ${product.description}</p>
                <p><strong>Código:</strong> ${product.code}</p>
                <p class="price">$${product.price}</p>
                <p><strong>Stock:</strong> ${product.stock}</p>
                <p><strong>Categoría:</strong> ${product.category}</p>
                <p><strong>Estado:</strong> ${product.status ? 'Activo' : 'Inactivo'}</p>
                <button class="btn btn-danger delete-btn" onclick="deleteProduct(${product.id})">Eliminar</button>
            </div>
        `).join('');
    }

    // Funciones para mostrar/ocultar errores
    function showError(message) {
        const errorDiv = document.getElementById('error-message');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        setTimeout(hideError, 5000);
    }

    function hideError() {
        document.getElementById('error-message').style.display = 'none';
    }
</script>
